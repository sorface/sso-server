# common properties

sorface:
  client:
    domain: ${CLIENT_SERVER_DOMAIN}

  cors:
    options:
      - pattern: /**
        allowed-origins: http://localhost:3000, http://localhost:5043
        allowed-headers: "*"
        allowed-methods: "*"
        exposed-headers: "*"
        allow-credentials: true

  cookie:
    session:
      domain-pattern: '^.+?\.(\w+\.[a-z]+)$'
      path: '/'
      name: 'JSESSIONID'
      http-only: false
    csrf:
      domain-pattern: '^.+?\.(\w+\.[a-z]+)$'
      path: '/'
      name: 'sorface_x_csrf_token'

  endpoint:
    uri-page-signin: '${sorface.client.domain}/account/signin'
    uri-page-signup: '${sorface.client.domain}/account/signup'
    uri-page-not-found: '${sorface.client.domain}/account/404'
    uri-page-profile: '${sorface.client.domain}/account'
    uri-api-login: "/api/accounts/signin"
    uri-api-logout: "/api/accounts/logout"

  oauth2:
    issuer-url: ${OAUTH_SERVER_ISSUER_URL}
    redis:
      complete-prefix: 'oauth2_auth_complete:'
      init-prefix: 'oauth2_auth_init:'
      ttl: 72000

spring:
  application:
    name: sorface-sso

  thymeleaf:
    prefix: classpath:/templates/
    suffix: .html

  mvc:
    static-path-pattern: /static/**

  web:
    resources:
      static-locations: classpath:static

  security:
    oauth2:
      client:
        registration:
          github:
            client-name: github
            client-id: ${OAUTH_CLIENT_GITHUB_ID}
            client-secret: ${OAUTH_CLIENT_GITHUB_SECRET}
          google:
            client-name: google
            clientId: ${OAUTH_CLIENT_GOOGLE_ID}
            clientSecret: ${OAUTH_CLIENT_GOOGLE_SECRET}
            authorization-grant-type: authorization_code
            scope:
              - profile
              - email
          yandex:
            client-name: yandex
            client-id: ${OAUTH_CLIENT_YANDEX_ID}
            client-secret: ${OAUTH_CLIENT_YANDEX_SECRET}
            authorization-grant-type: authorization_code
            provider: yandex
            redirect-uri: ${OAUTH_CLIENT_YANDEX_REDIRECT_URL}
          twitch:
            client-name: twitch
            client-id: ${OAUTH_CLIENT_TWITCH_ID}
            client-secret: ${OAUTH_CLIENT_TWITCH_SECRET}
            authorization-grant-type: authorization_code
            client-authentication-method: client_secret_post
            scope:
              - user:read:email
            provider: twitch
            redirect-uri: ${OAUTH_CLIENT_TWITCH_REDIRECT_URL}
        provider:
          yandex:
            authorization-uri: https://oauth.yandex.ru/authorize
            token-uri: https://oauth.yandex.ru/token
            user-name-attribute: default_email
            userInfoUri: https://login.yandex.ru/info
          twitch:
            authorization-uri: https://id.twitch.tv/oauth2/authorize
            token-uri: https://id.twitch.tv/oauth2/token
            userInfoUri: https://api.twitch.tv/helix/users/
            user-info-authentication-method: GET
            user-name-attribute: data

  mail:
    username: ${MAIL_NOTIFICATOR_USERNAME}
    password: ${MAIL_NOTIFICATOR_PASSWORD}
    port: 465
    host: smtp.yandex.ru
    properties:
      mail.transport.protocol: smtp
      mail.smtp.auth: true
      mail.smtp.starttls.enable: true
      mail.smtp.ssl.enable: true

  session:
    timeout: 1800
    redis:
      flush-mode: on_save
      namespace: sorface:session
      save-mode: on_set_attribute
      repository-type: indexed

  liquibase:
    enabled: true
    change-log: classpath:db/changelog/master.yaml

  autoconfigure:
    exclude: org.springframework.boot.autoconfigure.web.servlet.error.ErrorMvcAutoConfiguration

  data:
    redis:
      client-type: lettuce
      database: 0
      host: ${REDIS_HOST}
      port: 6379
      username: ${REDIS_USERNAME}
      password: ${REDIS_PASSWORD}
      lettuce:
        pool:
          max-active: 16
          max-idle: 8
